{{ extend 'layout.html' }}
<script type="text/javascript" src="/static/prisoner/jquery.tooltip.min.js"></script>
<script type="text/javascript" src="/static/prisoner/jquery.easing.1.3.js"></script>
<script type="text/javascript" src="/static/prisoner/jquery.tooltip.min.js"></script>
<link rel="stylesheet" href="/static/prisoner/css/jquery.fancybox.css?v=2.1.5" type="text/css" media="screen" />
<script type="text/javascript" src="/static/prisoner/jquery.fancybox.pack.js?v=2.1.5"></script>
<link rel="stylesheet" href="/static/prisoner/css/training.css" type="text/css" media="screen"/>
<script type="text/javascript" src="/static/prisoner/stats-box.js"></script>

{{ bonus_time = 60 }}
<!-- PHOTOS DOWNLOADED FROM OPENPHOTO.NET --> 
<div id="shadow" style="display: none; min-height: 2800px;">
 <h2>Training Guidelines for Image Tagging</h2>
 <p>
	When you tag a photo, you assign it a keyword or phrase for simplified searching and classification. 
    <div style="width: 45%; float: left;  max-width: 350px; margin: 0 10px;" class="column1">  
    <img src="/static/genova/chess.jpg" width="275" height="200" border="0">
    <p><em>This photo could be tagged with "Chessboard" to describe the scene or "King" to describe the
	object in the forefront.</em></p><br>
    <img src="/static/genova/autumn.jpg" width="275" height="200" border="0">
    <p><em>This photo could be tagged with "Nature" to describe the scene or "Autumn" to describe the
	time period.</em></p><br>
    <img src="/static/genova/pollination.jpg" width="275" height="200">
    <p><em>This photo could be tagged with "Pollination" to describe the story or activity or
	with "flower" to describe the main object in the forefront.</em></p><br><br>
    <p><strong>Definition:</strong> 'Abstract' photography is usually opposed to 'representational' or 'figurative' 
	in art. You might say that an 'abstract' image only represents its own form, and that form might 
	in some way 'represent' some larger concept (e.g., in the way that Malevich's _Tumbling Cube_ might 
	be said to represent 'instability'), but it doesn't represent an object (like, say, the Eiffel Tower). 
    </p>
    </div>  
    <div style="width: 45%; float: left; max-width: 350px; margin: 0 10px;" class="column2">
    <ul>
      <li>If a photo is in a stockpile of millions of other photos it is important to 
	add tags that describe it well. There are several ways how you can describe photo.
	It is important to capture the following different dimensions of the image rather
	than use a lot of tags describing this one category.
      <li><strong>Forefront</strong> tags - Some photos have main actors in the forefront of the
	image (e. g. the bear in the photo on the left). Tags can identify this aspect of the
	image.
      <li><strong>Background</strong> (scenery) tags - Tags can describe the background of the image.
	Is there landscape? Is it a picture of a city? Is there sea or mountains?
      <li><strong>Time </strong> tags - Is there any time information that can be deduced from 
	the picture? If it is black and white may
	be the picture is old. Clothes that people wear on the picture can tell you if the picture 
	was shot in the 90s or 80s. Does the pictures describe recent news events? Alternatively,
	is the picture shot during the day or night, sunrise or sunset?
      <li><strong>Technique </strong> - is it a macro photo (very small and/or close-up objects)?
	Is it a portrait? Is it an abstract photography? Is it a journalistic photography? A documentary
	photography? An action photography?
      <li><strong>Quality</strong> - Does it look like the photo has been taken by a professional
	or amateur? What is the resolution quality of the picture? Is it a web photo or a photo
	that can be printed in high quality?
      <li><strong>Story</strong> (activity) - A picture might have a story. Is there a bear looking out
	for its prey? Is there a flower being pollinated? These would be usually best described
	by an action verb.
      <li><strong>Relevance</strong> (conciness) - There is a number of options of choosing a keyword
	to describe the same category but not all of them are equally effective. Looking
	at the picture on the lower left one could pick the word 'sitting' as in 'the bee is sitting
	on the flower'. While this describes an activity it certainly is not exhaustive description
	and better words could be chosen to describe the activity in more detail (e. g. 'pollination'
	in this example).
      <li><strong>Correctness</strong> - If there is a cow on the picture tags like 'monkey' or 
	'aeroplane' are obviously incorrect.
    </ul>
   </div>
    <div {{ = "class=bonus" if training else "" }}>
    <button class="leave_training" style="margin-left: 35%; padding-left: 10px; padding-right: 10px; padding: 5px; margin-right: 35%;">Go Back to the Task</button>
    </div> 
    
                  <br><br><br>
    <div {{ = "class=bonus" if not training else "" }}>
    <h2>Testing Your Understanding of the Guidelines</h2>
   <div style="width: 45%; float: left;  max-width: 350px; margin: 0 10px;" class="column1">  
    <img style="margin-bottom: 10px; margin-top: 10px;" src="/static/genova/geese.jpg" width="275" height="200" border="0">
    <img style="margin-bottom: 10px; margin-top: 50px;" src="/static/genova/water.jpg" width="275" height="200">
    <img style="margin-bottom: 10px; margin-top: 40px;" src="/static/genova/bizarre.jpg" width="275" height="200">
   </div> 
    <div style="width: 45%; float: left; max-width: 350px; margin: 0 10px; margin-bottom: 20px;" class="column2">
    <form>
    <p>
	Look at the image tags below and write down which category do they belong to. Use only lowercase letters. To review
	the categories see the Training Guidelines.
    </p>
    <div>
      <div style="float: left;">
        <ul>
          <li>animals</li>
          <li>meadow</li>
          <li>close-up</li>
          <li>couple</li>
          <li>yard</li>
        </ul>
      </div>
      <div style="float: left; margin-left: 30px;">
        <ul>
          <li>birds</li>
          <li>geese</li>
          <li>seven</li>
          <li>flock</li>
          <li>beaks</li>
        </ul>
      </div>
</div>
<p style="clear: both;">
            Your answer: <input style="position: relative; left: 25px;" type="text" id="par1" name="article1" {{ = "value=close-up" if not training else "" }}>
    </p>  
        <p>
	Look at the image tags below and write down which category do they belong to. Use only lowercase letters. To review
	the categories see the Training Guidelines.
    </p>
    <div>
      <div style="float: left;">
        <ul>
          <li>water</li>
          <li>bottle</li>
          <li>spill</li>
          <li>clear</li>
          <li>drops</li>
        </ul>
      </div>
      <div style="float: left; margin-left: 30px;">
        <ul>
          <li>empty</li>
          <li>light</li>
          <li>open</li>
          <li>blue</li>
          <li>PET</li>
        </ul>
      </div>
</div>
<p style="clear: both;">
            Your answer: <input style="position: relative; left: 25px;" {{ = "value=water" if not training else "" }} type="text" id="par2" name="article2">
    </p>   
    <p>
	Look at the image tags below and write down which category do they belong to. Use only lowercase letters. To review
	the categories see the Training Guidelines.
    </p>
    <div>
      <div style="float: left;">
        <ul>
          <li>woman</li>
          <li>cat</li>
          <li>rat</li>
          <li>animal</li>
          <li>mountain</li>
        </ul>
      </div>
      <div style="float: left; margin-left: 20px;">
        <ul>
          <li>rain</li>
          <li>tree</li>
          <li>sit</li>
          <li>walk</li>
          <li>meet</li>
        </ul>
      </div>
      <div style="float: left; margin-left: 20px;">
        <ul>
          <li>clouds</li>
          <li>person</li>
          <li>sunset</li>
          <li>look</li>
          <li>abyss</li>
        </ul>
      </div>
</div>
<p style="clear: both;">
            Your answer: <input style="position: relative; left: 25px;" {{ = "value=danger" if not training else "" }} type="text" id="par3" name="article3">
    </p>
    </div>   
    <input id="quiz_given" type="hidden" {{= "value=1" if training else "value=0" }}>
    <button id="butt" style="margin-left: 180px; padding: 5px; padding-left: 20px; padding-right: 20px;">Submit Answers</button>
    <button class="cancel_training" style="padding: 5px; padding-left: 30px; padding-right: 30px; margin-left: 80px;">Cancel</button>
    </form>
    </div>
    </div>
</div>
<div class="congrats">
<h1>Congratulations!</h1>
<p>You have successfully completed the training</p>
<button class="leave_training" style="margin-left: 70px; padding: 5px;">Go Back to the Task</button>
</div>
<h1>Image Tagging</h1>

<div style="position: absolute; left: 410px;">
  <h3 style="margin-bottom: 3px;">Payment Details</h3>
  <div class="stats">
    <div class="tab selected">
      <div class="stat">{{=request.price_string}}</div> Per HIT
        <span class="details">
		 This job pays {{=request.price_string}} per letter via
		 bonus. <br><br>You can find
		 bonus payments in <i>Your Account-&gt;Account
		 Settings-&gt;<br>-&gt;View your account balance and
		 transaction history</i>.
	 </span>
       </div>
       <div class="tab">
         <div class="stat">{{= improbability_rate }}%</div> Approved
	   <span class="details">
		 <p>Your submitted keywords must pass an evaluation. You will be
		 notified of your work's approval within {{=bonus_time}}
		 minutes.</p>
		 <p>To ensure that our clients are best served, we require you
		 to go through <a class="training" href="#training">image tagging training</a> 
		 before you can begin work on this task.</p>
           </span>
	 </div>
	<div class="tab">
	  <div class="stat">{{=work_limit}}</div> Available
	    <span class="details">
		Today you can tag {{=work_limit}} images (there are {{ = len(pics) }} per HIT
		so {{=work_limit}} images translates into {{=work_limit/len(pics) if work_limit % len(pics) == 0 else work_limit/len(pics)+1}} HITs). This will
		change tomorrow, depending upon our client's needs.
            </span>
	  </div>
          <div id="details_box"></div> 
	</div>
  </div>
</div>

<div style="max-width: 325px;" class="taskdetails">
<p>

You will be presented with a series of pictures. Provide 5 keywords most
appropriately describing the content of these pictures.
These pictures may contain disagreeable content (explicit sexual
    content, violence, racism, etc.).  
    
</p>
</div>

<form action id="response" method="POST">
{{ i = 0 }}
{{ while i < len(pics): }}
<h2>Image</h2>
<img style="max-width: 275px;" src={{ = pics[i].url }}>
<!-- FROM http://www.morguefile.com/archive -->
<h2>Submit your Keywords</h2>
<p>
<div style="position: relative;">
<div class="train_info">
<p>To ensure that our clients are best served, we require you
                 to go through <a class="training" href="#training">image tagging training</a>
                 before you can begin work on this task.</p>
</div>
<div class="key_inputs" style="position: absolute; left: 0px; top: 0px;">
{{ for j in [1, 2, 3, 4, 5]: }}
{{ id = "keyword" + str(i*5+j) }}
Keyword {{=j}}: <input disabled="disabled" type="text" id={{=id}}><br>
{{ pass }}
{{ i += 1 }}
</div>
</div>
</p>
{{ pass }}
<input id="submit" type="submit" disabled="true" style="min-width: 70px; font-size: 16px; margin: 10px 0;" />
</form>


<script>

params = {
    track: true,
    delay: 0, 
    showURL: false, 
    showBody: " - ", 
    fade: 150,
    fixPNG: true, 
    opacity: 1, 
    left: -120,
     top: 9
};
$('.bonus').tooltip(params);
delete params.left
delete params.top
$('.crime').tooltip(params);

//######## Keywords for the actual task and the behavior of the Submit button of the 
//######## actual task

    
    
$('form input:text').change(function(){
	re1 = $('input[id=keyword1]').val();
	re2 = $('input[id=keyword2]').val();
	re3 = $('input[id=keyword3]').val();
	re4 = $('input[id=keyword4]').val();
	re5 = $('input[id=keyword5]').val();

	if(re1 != '' & re2 != '' & re3 != '' & re4 != '' & re5 != '')
	{
		$("input[type=submit]").removeAttr('disabled');
	}
      });
     
function show_training() {
  scrollTo(0,0);
  jQuery('#shadow').fadeIn().find('button').click(function(e) {
    e.preventDefault();
    pattern = /[a-z-]+/g;
    myText1 = $('input[id=par1]').val().match(pattern);
    answers1 = new Array("geese", "yard", "close-up");
    pattern = /[a-z-]+/g;
    myText2 = $('input[id=par2]').val().match(pattern);
    answers2 = new Array("bottle", "blue", "spill");
    pattern = /[a-z-]+/g;
    myText3 = $('input[id=par3]').val().match(pattern);
    answers3 = new Array("meet", "woman", "rain", "sunset");
           
    misses1 = $(answers1).not(myText1).length + $(myText1).not(answers1).length;
    misses2 = $(answers2).not(myText2).length + $(myText2).not(answers2).length;
    misses3 = $(answers3).not(myText3).length + $(myText3).not(answers3).length;
    overall = misses1 + misses2 + misses3
    if($('input[id=quiz_given]').val()=='0')
    {
      overall = 0
    }
        //   overall = 0  //This is for testing purposes only
    if(overall == 0)
    {
            //$('.test').hide();
      $('form input:text').prop("disabled", false);
      $('#shadow').fadeOut();
      $('.train_info').fadeOut();
      $('.key_inputs').css('position', 'relative');
      if($('input[id=quiz_given]').val()=='1')
      {
        $('.congrats').fadeIn();
      }
      $('.trainbutton').fadeIn();
      window.scroll(0,0);
    }
  });
}

$("#par1").on("change", function() {
  var explanations = {};
  explanations["time"] = "None of these tags give any information about time.";
  explanations["quality"] = "None of these tags describe the quality of the image.";
  jQuery('#err').remove();
  jQuery('#cor').remove();
  var answers = new Array("forefront","background","technique");
  var pattern = /[a-z-]+/g;
  var matches = this.value.match(pattern);
  matches = $.grep(matches, function(v, k){
    return $.inArray(v, matches) === k;
  });
  if(matches.length!=3)
  {
    $('#par1').after('<div id="err">You have listed either too many or too little categories.</div>')
  }
  else
  {
    if(!($(answers).not(matches).length == 0 && $(matches).not(answers).length == 0))
    {
      var feasible_answers = new Array("forefront", "background", "time", "technique", "quality", "story");
      if($(matches).not(feasible_answers).length == 0)
      {
        $('#par1').after('<div id="err">One or more of your answers is incorrect! (Hint: ' + explanations[$(matches).not(answers)[0]] + ')</div>');
      }
      else
      {
        $('#par1').after('<div id="err">Only categories explained in the Training Guidelines count as a valid answer.</div>');
      }
    }
    else
    {
      $('#par1').after('<div id="cor">Well done!</div>');
    }
  }
});

$("#par2").on("change", function() {
  var explanations = {};
  explanations["time"] = "There is no tag conveying time information in the list.";
  explanations["technique"] = "None of the tags quite describes how to picture was taken or what kind of photo it is.";
  explanations["quality"] = "None of the tags tells us about resolution, colors or sharpness of the image.";
  jQuery('#err').remove();
  jQuery('#cor').remove();
  var answers = new Array("forefront","background","story");
  var pattern = /[a-z-]+/g;
  var matches = this.value.match(pattern);
  matches = $.grep(matches, function(v, k){
    return $.inArray(v, matches) === k;
  });
  if(matches.length!=3)
  {
    $('#par2').after('<div id="err">This is not the right number of categories. Either too much or too little.</div>')
  }
  else
  {
    if(!($(answers).not(matches).length == 0 && $(matches).not(answers).length == 0))
    {
      var feasible_answers = new Array("forefront", "background", "time", "technique", "quality", "story");
      if($(matches).not(feasible_answers).length == 0)
      {
        $('#par2').after('<div id="err">One or more of your answers is incorrect! (Hint: ' + explanations[$(matches).not(answers)[0]] + ')</div>');
      }
      else
      {
        $('#par2').after('<div id="err">Only categories described in the above Training Guidelines are admissible answers.</div>');
      }
    }
    else
    {
      $('#par2').after('<div id="cor">Well done!</div>');
    }
  }
});

$("#par3").on("change", function() {
  var explanations = {};
  explanations["technique"] = "Read the Training Guidelines.";
  explanations["quality"] = "Review the Training Guidelines.";
  jQuery('#err').remove();
  jQuery('#cor').remove();
  var answers = new Array("forefront","background","time", "story");
  var pattern = /[a-z-]+/g;
  var matches = this.value.match(pattern);
  matches = $.grep(matches, function(v, k){
    return $.inArray(v, matches) === k;
  });
  if(matches.length!=4)
  {
    $('#par3').after('<div id="err">You are either missing a category or have written down too many of them.</div>')
  }
  else
  {
    if(!($(answers).not(matches).length == 0 && $(matches).not(answers).length == 0))
    {
      var feasible_answers = new Array("forefront", "background", "time", "technique", "quality", "story");
      if($(matches).not(feasible_answers).length == 0)
      {
        $('#par3').after('<div id="err">One or more of your answers is incorrect! (Hint: ' + explanations[$(matches).not(answers)[0]] + ')</div>');
      }
      else
      {
        $('#par3').after('<div id="err">Only categories described in the above Training Guidelines are admissible.</div>');
      }
    }
    else
    {
      $('#par3').after('<div id="cor">Well done!</div>');
    }
  }
});

function leave_training(){
  window.scroll(0,0);
  $('#shadow').fadeOut();
}

function hide_training() {
  window.scroll(0,0);
  $('#shadow').fadeOut();
  $('.congrats').fadeOut();
}

$(".training").bind('click', show_training);
$('.leave_training').bind('click', hide_training);    
$(".cancel_training").bind('click', leave_training);


$(document).on('click', 'a.training', show_training);    
</script>
