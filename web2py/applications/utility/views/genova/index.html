{{ extend 'layout.html' }}
<script type="text/javascript" src="/static/prisoner/jquery.tooltip.min.js"></script>
<script type="text/javascript" src="/static/prisoner/jquery.easing.1.3.js"></script>
<script type="text/javascript" src="/static/prisoner/jquery.tooltip.min.js"></script>
<link rel="stylesheet" href="/static/prisoner/css/jquery.fancybox.css?v=2.1.5" type="text/css" media="screen" />
<script type="text/javascript" src="/static/prisoner/jquery.fancybox.pack.js?v=2.1.5"></script>
<link rel="stylesheet" href="/static/prisoner/css/training.css" type="text/css" media="screen"/>
<script type="text/javascript" src="/static/prisoner/stats-box.js"></script>

{{ bonus_time = 60 }}
<!-- PHOTOS DOWNLOADED FROM OPENPHOTO.NET --> 
<div id="shadow" style="display: none; min-height: 2800px;">
 <h2>Guidelines for Tagging Classification</h2>
 <p>
	When you tag a photo, you assign it a keyword or phrase for simplified searching and classification. 
	Let us go through this information session on tags that may help you with the task
	of tagging picture. Tags describe an image. There are multiple ways to describe
	an image and so naturally there are several different categories of tags.
	Understanding this may help you organize your thoughts later on when you are
	tagging pictures. The word guidelines is chosen with a purpose and when tagging
	actual images in this task you can rely on your own common sense, instinct
	or experience. 
    <div style="width: 45%; float: left;  max-width: 350px; margin: 0 10px;" class="column1">  
    <img src="/static/genova/chess.jpg" width="275" height="200" border="0">
    <p><em>This picture can be tagged with "room", "indoors" (environment); "game of chess", 
	"chess tournament" (context); "chess pieces", "pawn", "king" (objects). Subjects are
	not present in the image.</em></p><br>
    <img src="/static/genova/autumn.jpg" width="275" height="200" border="0">
    <p><em>This photo could be tagged with "bank" (object), "park" (environment), "autumn" (time)
	or "calm" (mood).</em></p><br>
    <img src="/static/genova/pollination.jpg" width="275" height="200">
    <p><em>This photo can be tagged with "macro" (technique), "insect" (subject), "flower" (object),
	"bee" (subject), "nature" (environment), "pollination" (context), "spring" (time).</em></p><br><br>
<!--    <img src="/static/genova/russian_train.jpg" width="275" height="200">
    <p><em>This photo can be tagged with "train" (object), "railway station" (environment), 
	"train arrival" (context).
    </em>
    </p><br>
-->
    <img src="/static/genova/control/1.jpg" width="275" heigh="200">
    <p>
      <em>
	This image can be tagged with "collage" (technique), "Eiffel tower" (own name), 
	"landmark" (object), "Paris" (own name).
      </em>
    </p><br>
<!--
    <img src="/static/genova/control/venice.jpg" width="275" height="200">
    <p>
      <em>This photo can be tagged "Venice" (own name), "mask" (object), "carnival" (context),
	"historical" (style).
      </em>
    </p><br>
-->
    </div>  
    <div style="width: 45%; float: left; max-width: 350px; margin: 0 10px;" class="column2">
    <ul>
	<li><strong>Environment</strong> - When we want to describe an image we are effectively
		asking who is doing what to whom where and under what circumstances. 
		Environment related tags belong into the 'where' category. Chess pieces
		are being moved on a <em>chessboard</em>, the game of chess is being 
		played in a <em>room</em>. A bank and trees are located in a <em>park</em>
		or they could be in a <em>forest</em>. A bee pollinating a flower
		can be in a <em> or in a <em>front lawn</em> of a house.
	<li><strong>Activity</strong> - How to link the environment, subjects and objects together?
		Why are people indoors? Is it because they are having <em>dinner</em> together? Are
		they <em>praying</em> inside of a church? <em>Studying</em> inside of a school? 
		<em>Hunting</em> in a prairie? <em>Camping</em> by the river?	
	<li><strong>Actor</strong> - In an activity some subjects are taking action that
		has impact on themselves, other actors and objects. An example could
		be a <em>bee</em> pollinating a flower or a <em>man</em> moving a chess piece. 
	<li><strong>Object</strong> - The activity is putting into relationship actors who 
		use inanimate objects and this is all happening in a certain environment. 
		Fireman is driving a <em>car</em> to an accident. People are having dinner 
		using <em>plates</em> and <em>utensils</em>. People are camping using 
		<em>backpacks</em> and <em>tents</em>.
	<li><strong>Technique</strong> - How is the photo taken? How is the image drawn?
		Is it a <em>high speed photography</em> where you can see the climax 
		of an action? Is the photography <em>black and white</em> abstracting away 
		from color schemes and emphasizing structures of the objects? Is it a 
		<em>motion blur photography</em> where the photo was taken over a long 
		period of time? Is it a <em>collage</em> created by putting together
		hundreds of smaller pictures?
	<li><strong>Time</strong> - Was the picture taken in the evening? Is there a sunset or sunrise?
		Can you tell a season of the year? Do fallen leaves indicate autumn? 
		Or do the clothes of the people indicate summer or spring?
	<li><strong>Color scheme</strong> - This may better apply to drawing rather than photos.
		some drawings use shades of the same color or maybe the colors were chosen
		so that they show high degree of contrast? The colors may be sharp or fuzzy.
	<li><strong>Mood</strong> - Is the image evocative of certain emotion like fear
		anxiety or nausea? Or does it seem to have a rather calming effect on 
		you?
<!--
	<li><strong>Proper Name</strong> - Can you precisely identify objects, subjects or environments
		in the picture using their names, e. g. Golden Gate Bridge, Statue of Liberty,
		Miami, Millenium Park in Chicago, Ashton Kutcher or Chevrolet Camaro?
-->
	<li><strong>Style</strong> - Is the style <em>dada</em>? Does it belong into the movement of
		<em>impressionism</em>? Does it belong into Andy Warhol's visual art movement
		<em>pop art</em>?
<!--	<li><strong>Genre</strong> - Is this a <em>landscape</em> photography? Or rather
		a <em>travel</em> photography? Or a <em>portrait</em>?
-->
    </ul>
   </div>
    <div {{ = "class=bonus" if training else "" }}>
    <button class="leave_training" style="margin-left: 35%; padding-left: 10px; padding-right: 10px; padding: 5px; margin-right: 35%;">Go Back to the Task</button>
    </div> 
    
                  <br><br><br>
    <div {{ = "class=bonus" if not training else "" }}>
    <div class="quiz" style="clear: both">
    <h2>Testing Your Understanding of the Guidelines</h2>
    <form>
    <p>
	Look at the tags below and write down (in the text field to the right of the tag) which photo 
	category do they describe. To review the categories see the Training Guidelines.
    </p>
    <div style="clear: both">
      <div style="float: left; min-width: 200px;">
        <ol>
          <li>eagle
          <li>Haute couture
          <li>black hole
          <li>Princess Diana
          <li>Mt. Rainier
        </ol>
      </div>
      <div style="float: left;">
        <ul style="list-style-type: none;">
          <li style="position: relative;"><input type="text" id="par1" {{ = "value=wildlife" if not training else "" }}>
          <li style="position: relative;"><input type="text" id="par2" {{ = "value=fashion" if not training else "" }}>
          <li style="position: relative;"><input type="text" id="par3" {{ = "value=astrophotography" if not training else "" }}>
          <li style="position: relative;"><input type="text" id="par4" {{ = "value=paparazzi" if not training else "" }}>
          <li style="position: relative;"><input type="text" id="par5" {{ = "value=landscape" if not training else "" }}>
        </ul>
      </div>
</div>
    <div style="clear: both">
      <div style="float: left; min-width: 200px">
        <ol>
          <li>collage</li>
          <li>Golden Gate Bridge</li>
          <li>bugs</li>
          <li>Tadj Mahal</li>
          <li>zebra</li>
        </ol>
      </div>
      <div style="float: left;">
        <ul style="list-style-type: none;">
          <li style="position: relative;"><input style="position: relative; left: 25px;" type="text" id="par6" name="article1" {{ = "value=sports" if not training else "" }}>
          <li style="position: relative;"><input style="position: relative; left: 25px;" type="text" id="par7" name="article1" {{ = "value=architectural" if not training else "" }}>
          <li style="position: relative;"><input style="position: relative; left: 25px;" type="text" id="par8" name="article1" {{ = "value=macro" if not training else "" }}>
          <li style="position: relative;"><input style="position: relative; left: 25px;" type="text" id="par9" name="article1" {{ = "value=travel" if not training else "" }}>
          <li style="position: relative;"><input style="position: relative; left: 25px;" type="text" id="par10" name="article1" {{ = "value=wildlife" if not training else "" }}>
        </ul>
      </div>
</div>
    <div style="clear: both">
      <div style="float: left; min-width: 200px;">
        <ol>
          <li>autumn</li>
          <li>Earth</li>
          <li>python</li>
          <li>catwalk</li>
          <li>dada</li>
        </ol>
      </div>
      <div style="float: left;">
        <ul style="list-style-type: none;">
          <li style="position: relative;"><input style="position: relative; left: 25px;" type="text" id="par11" {{ = "value=fashion" if not training else "" }}>
          <li style="position: relative;"><input style="position: relative; left: 25px;" type="text" id="par12" {{ = "value=astrophotography" if not training else "" }}>
          <li style="position: relative;"><input style="position: relative; left: 25px;" type="text" id="par13" {{ = "value=wildlife" if not training else "" }}>
          <li style="position: relative;"><input style="position: relative; left: 25px;" type="text" id="par14" {{ = "value=fashion" if not training else "" }}>
          <li style="position: relative;"><input style="position: relative; left: 25px;" type="text" id="par15" {{ = "value=sports" if not training else "" }}>
        </ul>
      </div>
</div>
    </div>   
    <input id="quiz_given" type="hidden" {{= "value=1" if training else "value=0" }}>
<div style="clear: both;">
    <button id="butt" style="margin-left: 180px; padding: 5px; padding-left: 20px; padding-right: 20px;">Submit Answers</button>
    <button class="cancel_training" style="padding: 5px; padding-left: 30px; padding-right: 30px; margin-left: 80px;">Cancel</button>
</div>
    </form>
    </div>
    </div>
</div>
<div class="congrats">
<h1>Congratulations!</h1>
<p>You have successfully completed the training</p>
<button class="leave_training" style="margin-left: 70px; padding: 5px;">Go Back to the Task</button>
</div>
<h1>Image Tagging</h1>

<div style="position: absolute; left: 410px;">
  <h3 style="margin-bottom: 3px;">Payment Details</h3>
  <div class="stats">
    <div class="tab selected">
      <div class="stat">{{=request.price_string}}</div> Per HIT
        <span class="details">
		 This job pays {{=request.price_string}} per {{ = len(pics) }} images via
		 bonus. <br><br>You can find
		 bonus payments in <i>Your Account-&gt;Account
		 Settings-&gt;<br>-&gt;View your account balance and
		 transaction history</i>.
	 </span>
       </div>
       <div class="tab">
         <div class="stat">{{= improbability_rate }}%</div> Approved
	   <span class="details">
		 <p>Your submitted keywords must pass an evaluation. You will be
		 notified of your work's approval within {{=bonus_time}}
		 minutes.</p>
		 <p>To ensure that our clients are best served, we require you
		 to go through <a class="training" href="#training">image tagging training</a> 
		 before you can begin work on this task.</p>
           </span>
	 </div>
	<div class="tab">
	  <div class="stat">{{=work_limit/len(pics) if work_limit % len(pics) == 0 else work_limit/len(pics)+1}}</div> Available
	    <span class="details">
		Today you can tag {{=work_limit}} images (there are {{ = len(pics) }} per HIT
		so {{=work_limit}} images translates into {{=work_limit/len(pics) if work_limit % len(pics) == 0 else work_limit/len(pics)+1}} HITs). This will
		change tomorrow, depending upon our client's needs.
            </span>
	  </div>
          <div id="details_box"></div> 
	</div>
  </div>
</div>

<div style="max-width: 325px;" class="taskdetails">
<p>

You will be presented with a series of pictures. Provide 5 keywords most
appropriately describing the content of these pictures.
These pictures may contain disagreeable content (explicit sexual
    content, violence, racism, etc.).  
    
</p>
</div>

<form action id="response" method="POST">
{{ i = 0 }}
{{ while i < len(pics): }}
<h2>Image</h2>
<img style="max-width: 275px;" src={{ = pics[i].url }}>
<!-- FROM http://www.morguefile.com/archive -->
<h2>Submit your Keywords</h2>
<p>
<div style="position: relative;">
<div class="train_info">
<p>To ensure that our clients are best served, we require you
                 to go through <a class="training" href="#training">image tagging training</a>
                 before you can begin work on this task.</p>
</div>
<div class="key_inputs" style="position: absolute; left: 0px; top: 0px;">
{{ for j in [1, 2, 3, 4, 5]: }}
{{ id = "keyword" + str(i*5+j) }}
Keyword {{=j}}: <input disabled="disabled" type="text" id={{=id}}><br>
{{ pass }}
{{ i += 1 }}
</div>
</div>
</p>
{{ pass }}
<input id="submit" type="submit" disabled="true" style="min-width: 70px; font-size: 16px; margin: 10px 0;" />
</form>


<script>

params = {
    track: true,
    delay: 0, 
    showURL: false, 
    showBody: " - ", 
    fade: 150,
    fixPNG: true, 
    opacity: 1, 
    left: -120,
     top: 9
};
$('.bonus').tooltip(params);
delete params.left
delete params.top
$('.crime').tooltip(params);

//######## Keywords for the actual task and the behavior of the Submit button of the 
//######## actual task

    
    
$('form input:text').change(function(){
	re1 = $('input[id=keyword1]').val();
	re2 = $('input[id=keyword2]').val();
	re3 = $('input[id=keyword3]').val();
	re4 = $('input[id=keyword4]').val();
	re5 = $('input[id=keyword5]').val();

	if(re1 != '' & re2 != '' & re3 != '' & re4 != '' & re5 != '')
	{
		$("input[type=submit]").removeAttr('disabled');
	}
      });
     
function show_training() {
  scrollTo(0,0);
  jQuery('#shadow').fadeIn().find('button').click(function(e) {
    e.preventDefault();
/*
	THIS WAS THE OLD VALIDATION ALGORITHM FOR WHEN WE HAD SEVERAL ANSWERS
	IN ONE INPUT FIELD

	NOW, HOWEVER, WE ARE TRANSITIONING TO A SYSTEM WITH ONE ANSWER PER
	INPUT FIELD

    pattern = /[a-z-]+/g;
    myText1 = $('input[id=par1]').val().match(pattern);
    answers1 = new Array("geese", "yard", "close-up");
    pattern = /[a-z-]+/g;
    myText2 = $('input[id=par2]').val().match(pattern);
    answers2 = new Array("bottle", "blue", "spill");
    pattern = /[a-z-]+/g;
    myText3 = $('input[id=par3]').val().match(pattern);
    answers3 = new Array("meet", "woman", "rain", "sunset");
           
    misses1 = $(answers1).not(myText1).length + $(myText1).not(answers1).length;
    misses2 = $(answers2).not(myText2).length + $(myText2).not(answers2).length;
    misses3 = $(answers3).not(myText3).length + $(myText3).not(answers3).length;
    overall = misses1 + misses2 + misses3
*/
    //#jQuery('.err').remove();
    if($('input[id=quiz_given]').val()=='0')
    {
      overall = 15
    }
    //overall = 0  //This is for testing purposes only
    overall = $('.quiz input[name=correct]').length
    if(overall == 15)
    {
            //$('.test').hide();
      $('form input:text').prop("disabled", false);
      $('#shadow').fadeOut();
      $('.train_info').fadeOut();
      $('.key_inputs').css('position', 'relative');
      if($('input[id=quiz_given]').val()=='1')
      {
        $('.congrats').fadeIn();
      }
      $('.trainbutton').fadeIn();
      window.scroll(0,0);
    }
    else
    {
/*
	first_mistake_position = $('.quiz input:text').index($('.quiz input[name=false]')[0]);
	we_have_a_go = $('.quiz input[name=false]')[0]!=undefined
	if(we_have_a_go)
	{
		if(first_mistake_position == 6 & $('.quiz input[name=false]')[0].value == "travel")
		{
			hint = "Since Golden Gate Bridge is located in the United States we decided not to categorize it as 'travel'.";
		}
		else if(first_mistake_position == 4 & $('.quiz input[name=false]')[0].value == "wildlife")
		{
			hint = "Even though there certainly is wildlife in Mt. Rainier the keyword itself does not hint at a living entity.";
		}
		else if(first_mistake_position == 7 & $('.quiz input[name=false]')[0].value == "wildlife")
		{
			hint = "While bugs certainly are living beings we feel that they would more appropriately be classified in a different category.";
		}
		else if(first_mistake_position == 4 & $('.quiz input[name=false]')[0].value == "travel")
		{
			hint = "Since Mt. Rainier is located in the US we feel it would more appropriately be classified in a different category.";
		}
	}
	else{
		if(first_mistake_position +1 < 6)
		{
			hint = "One of the first five or you have not filled in all the answers yet.";
		} 
		else if(first_mistake_position + 1 < 11)
		{
			hint = "One of the second batch of five.";
		}
		else
		{
			hint = "One of the last five.";
		}
	}
*/
	$('div.err').remove();
	$('#butt').parent().before('<div class="err" style="left: 1em; clear: both;">One or more answers is incorrect or missing!</div>');
//(Hint: ' + hint+' )</div>');
    }
  });
}

$('.quiz input:text').on("change", function() { 
	/* ... */ 
  possible_answers = new Array("environment", "activity", "actor", "object", "technique", "time", "color scheme",
	"mood", "own name", "style", "genre");
  user_answer = new Array(this.value.toLowerCase());
  if($(user_answer).not(possible_answers).length != 0)
  {
     	if($(this).attr('id').length==4)
	{
	  multiplier = $(this).attr('id')[3];
	}
	else
	{
	  multiplier = $(this).attr('id')[3] + $(this).attr('id')[4];
	}

  	if(multiplier < 6)
  	{
	  my_top = (multiplier-1.1)*23;
	}
	else if(multiplier < 11)
	{
	  my_top = (multiplier-6.1)*23;
	}
	else
	{
	  my_top = (multiplier-11.1)*23;
	}
	$(this).after('<span style="position: absolute; left: 200px; min-width: 200px; top: ' + my_top + 'px;" class="err">Not a possible answer!</span>');
  }
  else
  {
    $(this).parent().find('.err').remove();
    position_input = $('.quiz input:text').index($(this));
    correct_answers = new Array("actor", "activity", "object", 
          "proper name", "proper name", "technique", "proper name", "actor",
          "proper name", "actor", "time", "object", "actor",
          "environment", "style");
    if(correct_answers[position_input]==user_answer)
    {
        this.name="correct";
    }
    else
    {
	this.name="false";
	//$('#butt').parent().before('<div id="err" style="clear: both;">One or more answers is incorrect! (Hint: )</div>');
    }
  }        
    });

/*
$("#par1").on("change", function() {
  var explanations = {};
  explanations["time"] = "None of these tags give any information about time.";
  explanations["quality"] = "None of these tags describe the quality of the image.";
  jQuery('#err').remove();
  jQuery('#cor').remove();
  var answers = new Array("forefront","background","technique");
  var pattern = /[a-z-]+/g;
  var matches = this.value.match(pattern);
  matches = $.grep(matches, function(v, k){
    return $.inArray(v, matches) === k;
  });
  if(matches.length!=3)
  {
    $('#par1').after('<div id="err">You have listed either too many or too few categories.</div>')
  }
  else
  {
    if(!($(answers).not(matches).length == 0 && $(matches).not(answers).length == 0))
    {
      var feasible_answers = new Array("forefront", "background", "time", "technique", "quality", "story");
      if($(matches).not(feasible_answers).length == 0)
      {
        $('#par1').after('<div id="err">One or more of your answers is incorrect! (Hint: ' + explanations[$(matches).not(answers)[0]] + ')</div>');
      }
      else
      {
        $('#par1').after('<div id="err">Only categories explained in the Training Guidelines count as a valid answer.</div>');
      }
    }
    else
    {
      $('#par1').after('<div id="cor">Well done!</div>');
    }
  }
});

$("#par2").on("change", function() {
  var explanations = {};
  explanations["time"] = "There is no tag conveying time information in the list.";
  explanations["technique"] = "None of the tags quite describes how to picture was taken or what kind of photo it is.";
  explanations["quality"] = "None of the tags tells us about resolution, colors or sharpness of the image.";
  jQuery('#err').remove();
  jQuery('#cor').remove();
  var answers = new Array("forefront","background","story");
  var pattern = /[a-z-]+/g;
  var matches = this.value.match(pattern);
  matches = $.grep(matches, function(v, k){
    return $.inArray(v, matches) === k;
  });
  if(matches.length!=3)
  {
    $('#par2').after('<div id="err">This is not the right number of categories. Either too much or too few.</div>')
  }
  else
  {
    if(!($(answers).not(matches).length == 0 && $(matches).not(answers).length == 0))
    {
      var feasible_answers = new Array("forefront", "background", "time", "technique", "quality", "story");
      if($(matches).not(feasible_answers).length == 0)
      {
        $('#par2').after('<div id="err">One or more of your answers is incorrect! (Hint: ' + explanations[$(matches).not(answers)[0]] + ')</div>');
      }
      else
      {
        $('#par2').after('<div id="err">Only categories described in the above Training Guidelines are admissible answers.</div>');
      }
    }
    else
    {
      $('#par2').after('<div id="cor">Well done!</div>');
    }
  }
});

$("#par3").on("change", function() {
  var explanations = {};
  explanations["technique"] = "Read the Training Guidelines.";
  explanations["quality"] = "Review the Training Guidelines.";
  jQuery('#err').remove();
  jQuery('#cor').remove();
  var answers = new Array("forefront","background","time", "story");
  var pattern = /[a-z-]+/g;
  var matches = this.value.match(pattern);
  matches = $.grep(matches, function(v, k){
    return $.inArray(v, matches) === k;
  });
  if(matches.length!=4)
  {
    $('#par3').after('<div id="err">You are either missing a category or have written down too many of them.</div>')
  }
  else
  {
    if(!($(answers).not(matches).length == 0 && $(matches).not(answers).length == 0))
    {
      var feasible_answers = new Array("forefront", "background", "time", "technique", "quality", "story");
      if($(matches).not(feasible_answers).length == 0)
      {
        $('#par3').after('<div id="err">One or more of your answers is incorrect! (Hint: ' + explanations[$(matches).not(answers)[0]] + ')</div>');
      }
      else
      {
        $('#par3').after('<div id="err">Only categories described in the above Training Guidelines are admissible.</div>');
      }
    }
    else
    {
      $('#par3').after('<div id="cor">Well done!</div>');
    }
  }
});
*/

function leave_training(){
  window.scroll(0,0);
  $('#shadow').fadeOut();
}

function hide_training() {
  window.scroll(0,0);
  $('#shadow').fadeOut();
  $('.congrats').fadeOut();
}

$(".training").bind('click', show_training);
$('.leave_training').bind('click', hide_training);    
$(".cancel_training").bind('click', leave_training);


$(document).on('click', 'a.training', show_training);    
</script>
