{{ extend 'layout.html' }}
<script type="text/javascript" src="/static/prisoner/jquery.tooltip.min.js"></script>
<script type="text/javascript" src="/static/prisoner/jquery.easing.1.3.js"></script>
<script type="text/javascript" src="/static/prisoner/jquery.tooltip.min.js"></script>
<link rel="stylesheet" href="/static/prisoner/css/jquery.fancybox.css?v=2.1.5" type="text/css" media="screen" />
<script type="text/javascript" src="/static/prisoner/jquery.fancybox.pack.js?v=2.1.5"></script>
<link rel="stylesheet" href="/static/prisoner/css/prisoner.css" type="text/css" media="screen"/>
<link rel="stylesheet" href="/static/genova/css/style.css" type="text/css" media="screen"/>
<script type="text/javascript" src="/static/genova/training.js"></script>
<script type="text/javascript" src="/static/genova/feedback.js"></script>

{{ include 'stats_box.html' }}

<style>
.keyword {
	position: absolute; 
	left: 56px;
	}  
</style>


{{ bonus_time = 60 }}

{{ include 'genova/training.html' }}

<h1>Tag Images</h1>

{{ stats_box() }}

<div style="max-width: 325px; margin-bottom: 175px" class="taskdetails">
<p>
You will be presented with a series of pictures. Provide 5 tags that most
appropriately describe the content of these pictures.
The pictures may contain content that some find disturbing (explicit sexual
content, violence, racism, etc.).  
</p>
</div>

<table class="genova_image">
    <form action id="response" method="POST">
    {{ i = 0 }}
    {{ while i < len(pics): }}
<tbody class="key_inputs">
<tr>
  <td colspan="3">
  <h2 class="genova_subtitle">Image</h2>
  </td>
<tr>
  <td colspan="3">
  <img class="genova_image" src={{ = pics[i].url }}>
  </td>
</tr>
<tr>
  <td colspan="3">
  <h2 class="genova_subtitle">Submit your Tags</h2>
  </td>
</tr>
{{ for j in [1, 2, 3, 4, 5]: }}
{{ id = "keyword" + str(i*5+j) }}
<tr>
  <td><p class="image_tag">Tag {{=j}}: </p></td>
  <td><input {{ = "disabled" if hit_num == 0 else "" }} name="image_tag" type="text" id={{=id}} class="keyword"></td>
{{ if j == 1: }}
<td rowspan="5">
{{ if hit_num == 0: }}  
<p class="train_info">You must complete <a class="training" href="#training">image tagging training</a>
                 before working.</p>
{{ pass }}
{{ if hit_num == work_limit: }}
<p class="train_info">You have finished all the HITs available. There is no more work to be done. Thank you for 
your participation!</p>
{{ pass }}
{{ pass }}
</td>
</tr>
{{ pass }}
</tbody>
<tr>
<td colspan="3">
<table class="radio">
<tr class="genova_radio">
  <td rowspan="2">This photo is</td>
  <td>  
  {{ radio_id = "disturbingness" + str(i) }}
  <input {{ = "disabled" if hit_num == 0 else "" }} type="radio" name={{ = radio_id }}  id={{ = radio_id }} value="0">&nbsp;&nbsp;appropriate
  </td>
  <td style="text-align: left;" rowspan="2">for a PG audience.</td>
</tr>
<tr class="genova_radio">
  <td>
  <input {{ = "disabled" if hit_num == 0 else "" }} type="radio" name={{ = radio_id }}  id={{ = radio_id }} value="1">&nbsp;&nbsp;inappropriate
  </td>
</tr>
</table>
</td>
</tr>
{{ i += 1 }}
{{ pass }}
<tr>
<td>
<p class="error_message">Some of the tags you entered are bad. Go back and fix the problems highlighted in red.</p>
<input id="submit" disabled type="submit" style="min-width: 70px; font-size: 16px; margin: 10px 0;" />
</td>
<td colspan="2">
</td>
</tr>
</form>
</table>


<script>

var missing = $('tbody.key_inputs input:text').length;
var total_inputs = 0;
var unique_count = 0;
var values = new Array();
var debug1 = "";
var debug2 = "";
var fivetuple_keywords = new Array();
var duplicity_troubles = 0;
var radios_check = 0;
var all_radios = $('tbody input:radio').length/2;

$('#response').submit(function(f) {
	$('.error_message').hide();
	$('p.tag_error').attr('class', 'image_tag');
	$('input.input_error').attr('class', 'image_tag');
  	radios_check = $('td input:radio:checked').length;

	//$('p.error_message').hide();
	
	$('input[class=keyword]').each(function(i) {
 		values[$(this).id] = $(this).val();
        	total_inputs = total_inputs+1;
        	if(values[$(this).id] == "")
        	{
                	missing = missing + 1;
        	}
	});


	jQuery('tbody.key_inputs').each(function(k) {
        	fivetuple_keywords = new Array();
        	for(var m = 0; m < 5; m++)
        	{
                	fivetuple_keywords.push($(this).find('input')[m].value);
        	}
        	unique_ans = jQuery.unique(fivetuple_keywords);
        	if(unique_ans.length != 5)
        	{
                	duplicity_troubles = duplicity_troubles + 1;
        	}

	});

	if(missing == 0 & duplicity_troubles == 0 & radios_check == all_radios)
  	{
		return;
  	}
	else
	{
		$('input:radio').each(function(){
                	if(!$('#' + $(this).attr('name')).is(':checked'))
                	{
                        	$(this).parent().parent().parent().parent().attr('class', 'input_error');
                	}
       	 	});

		$('tbody input:text[value=""]').each(function(){
			$(this).attr('class', 'input_error');
			$(this).parent().parent().find('p.image_tag').attr('class', 'tag_error');
		});

		$('p.error_message').show();
		f.preventDefault();
	}

});
    

     

function leave_training(){
  window.scroll(0,0);
  $('#shadow').fadeOut();
}

function hide_training() {
  window.scroll(0,0);
  $('#shadow').fadeOut();
  $('.congrats').fadeOut();
}

$(".training").bind('click', show_training);
$('.leave_training').bind('click', hide_training);    
$(".cancel_training").bind('click', leave_training);


$(document).on('click', 'a.training', show_training);    
</script>
